@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@using System.Security.Claims;
@model CI.Models.ViewModels.Mission
@{
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" rel="stylesheet" />
    foreach (var item in Model.Missions)
    {
        <div class="item card1 col-md-6 col-lg-4 col-sm-6 mt-3">
            <div class="thumbnail card d-flex">
                <div class="img-event">



                    @if (DateTime.Now > @item.StartDate || @item.AvbSeat == 0)
                    {
                        <div class=" closeicon-badge">Closed</div>
                    }
                    else if (@item.MissionApplications.Where(c => c.MissionId.Equals(@item.MissionId) && c.UserId.Equals(long.Parse(@User?.Claims.FirstOrDefault(c => c.Type == ClaimTypes.Sid)?.Value))).ToList().Count > 0)
                    {
                        <div class=" appliedicon-badge">Applied</div>
                    }


                    <img class="group list-group-image w-100 h-100"
                 src='@item.MissionMedia.ElementAt(0).MediaPath' alt="" id='@item.MissionMedia.ElementAt(0).MissionMediaId-@item.MissionMedia.ElementAt(0).MediaPath'
                 onmouseover="view_detail_onmouseover(@item.MissionId,'@item.MissionMedia.ElementAt(0).MissionMediaId-@item.MissionMedia.ElementAt(0).MediaPath')"
                 onmouseout="view_detail_onmouseout(@item.MissionId,'@item.MissionMedia.ElementAt(0).MissionMediaId-@item.MissionMedia.ElementAt(0).MediaPath')" />



                    <div class="location-img">
                        <img class="text-light" src="images/pin.png" alt="">
                        <span class="text-light">@item.City.Name</span>
                    </div>
                    @{
                        if (@item.FavoriteMissions.Where(c => c.MissionId.Equals(@item.MissionId) && c.UserId.Equals(long.Parse(@User?.Claims.FirstOrDefault(c => c.Type == ClaimTypes.Sid)?.Value))).ToList().Count > 0)
                        {

                            <button onclick="add_to_favourite(@User?.Claims.FirstOrDefault(c=>c.Type==ClaimTypes.Sid)?.Value,@item.MissionId)" class="like-img border-0">
                                <img class="text-light heart-@item.MissionId" style="height:24px;" src="images/red-heart.png" alt="">
                            </button>
                        }
                        else
                        {
                            <button onclick="add_to_favourite(@User?.Claims.FirstOrDefault(c=>c.Type==ClaimTypes.Sid)?.Value,@item.MissionId)" class="like-img border-0">
                                <img class="text-light heart-@item.MissionId" src="images/heart.png" alt="">
                            </button>
                        }
                    }

                    @{

                        <button class="stop-img border-0" data-bs-toggle="modal" data-bs-target="#recommend" style="cursor:pointer;">
                            <img class="text-light" src="images/user.png" alt="">
                        </button>

                    }

                    <button class="stop-img border-0">
                        <img class="text-light" src="images/user.png" alt="">
                    </button>
                    <button class="mission-theme border-0">
                        <span class="p-2">@item.Theme.Title</span>
                    </button>


                     


                    @*//view details conditions*@

                    @if (@item.Deadline < DateTime.Now || DateTime.Now > @item.StartDate || @item.AvbSeat == 0 ||
            (@item.MissionApplications.Where(c => c.MissionId.Equals(@item.MissionId) && c.UserId.Equals(long.Parse(@User?.Claims.FirstOrDefault(c => c.Type == ClaimTypes.Sid)?.Value))).ToList().Count > 0))
                    {
                        <div class="view-detail position-absolute" style="display:none;" onmouseover="view_detail_onmouseover(@item.MissionId,'@item.MissionMedia.ElementAt(0).MissionMediaId-@item.MissionMedia.ElementAt(0).MediaPath')"
                     onmouseout="view_detail_onmouseout(@item.MissionId,'@item.MissionMedia.ElementAt(0).MissionMediaId-@item.MissionMedia.ElementAt(0).MediaPath')" id=@item.MissionId>
                            <a href='/volunteering_mission/@item.MissionId' class="applyButton  btn d-flex  justify-content-around align-items-center" style="border: 2px solid white; color: white;">
                                View Details <img class="ms-2" src="images/right-arrow.png" alt="">
                            </a>
                        </div>
                    }


                    else
                    {
                        <div class="view-detail position-absolute" style="display:none;" onmouseover="view_detail_onmouseover(@item.MissionId,'@item.MissionMedia.ElementAt(0).MissionMediaId-@item.MissionMedia.ElementAt(0).MediaPath')"
                     onmouseout="view_detail_onmouseout(@item.MissionId,'@item.MissionMedia.ElementAt(0).MissionMediaId-@item.MissionMedia.ElementAt(0).MediaPath')" id=@item.MissionId>
                            <a class=" applyButton   btn d-flex  justify-content-center align-items-center" style="border: 2px solid white; color: white;" disable>
                                Apply First To Access
                            </a>
                            @*  StartDate is @item.StartDate.ToString().Substring(0,10)*@
                        </div>
                    }
                </div>



                <div class="caption card-body">
                    <h4 class="group card-title inner list-group-item-heading">
                        @item.Title?.Substring(0,50)...
                    </h4>
                    <p class="group inner list-group-item-text">
                        @item.Description?.Substring(0,100).....
                    </p>
                    <div class="d-flex list-view justify-content-between">
                        <span class="organization">@item.OrganizationName</span>
                        <div class="rating">
                            @{
                                double avg_rating = 0;
                                int total = @item.MissionRatings.Count;
                                foreach (var rating in @item.MissionRatings)
                                {
                                    avg_rating = avg_rating + rating.Rating;
                                }
                                avg_rating = avg_rating / total;
                                for (var i = 1; i <= 5; i++)
                                {
                                    if (i <= @avg_rating)
                                    {
                                        <img style="height:30px" src="~/images/selected-star.png" alt="" />
                                    }
                                    else
                                    {
                                        <img style="height:30px" src="~/images/star-empty.png" alt="" />
                                    }
                                }
                            }
                        </div>
                    </div>
                    <div class="duration-seats-info mt-4">
                        <div class="duration">
                            @{
                                if (@item.MissionType == "GOAL")
                                {
                                    <p id="duration-txt" style="margin-bottom: 0;">@item.GoalObject</p>
                                }
                                else
                                {
                                    <p id="duration-txt" style="margin-bottom: 0;">From @item.StartDate?.ToString().Substring(0,10) To @item.EndDate?.ToString().Substring(0,10)</p>
                                }
                            }
                        </div>
                    </div>
                    <div class="d-flex justify-content-between border-bottom mt-3">
                        <div class="Seats d-flex align-items-center">
                            @{
                                if (@item.AvbSeat != 0)
                                {
                                    <img src="images/Seats-left.png" alt="">
                                    <span>
                                        @item.TotalSeats <p>seats left</p>
                                        @*   @item.AvbSeat <p>seats left</p>

                                            //@{
                                            //    @item.TotalSeats
                                            //    -
                                            //    @item.MissionApplications.Where(c => c.MissionId.Equals(@item.MissionId)).ToList().Count()
                                            //}*@

                                    </span>
                                }
                            }
                        </div>
                        <div class="deadline d-flex align-items-center">
                            @{
                                if (@item.MissionType == "GOAL")
                                {
                                    string? str1 = @item.GoalObject;
                                    string str2 = string.Empty;
                                    int goal = 0;
                                    for (int i = 0; i <= str1.Length - 1; i++)
                                    {
                                        if (Char.IsDigit(str1[i]))
                                            str2 += str1[i];
                                    }
                                    if (str2.Length > 0)
                                    {
                                        goal = int.Parse(str2);
                                    }
                                    double? percent = (@item.Achieved / (double)goal) * 100;
                                    <img src="images/achieved.png" alt="">
                                    <div class="w-100">
                                        <div class="progress" style="width:90%;margin-left:10px;">
                                            <div class="progress-bar" role="progressbar" style="width:@percent%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <p class="text-muted">@item.Achieved achieved</p>
                                    </div>
                                }
                                else
                                {
                                    <img src="images/deadline.png" alt="">
                                    <span>
                                        @item.Deadline.ToString().Substring(0,10)
                                        @*?*@
                                        <p>Deadline</p>
                                    </span>
                                }
                            }
                        </div>
                    </div>
                    <div class="d-flex justify-content-center mt-4">
                        <a>
                            @if (DateTime.Now > @item.StartDate || @item.TotalSeats == 0)
                            {
                                <button class="closeButton btn" disabled>
                                    Closed
                                </button>
                            }
                            else if (@item.MissionApplications.Where(c => c.MissionId.Equals(@item.MissionId) && c.UserId.Equals(long.Parse(@User?.Claims.FirstOrDefault(c => c.Type == ClaimTypes.Sid)?.Value))).ToList().Count > 0)
                            {
                                <button class="alreadyapplyButton btn " disabled>
                                    Already Applied
                                </button>
                            }
                            else
                            {
                                <button onclick="apply_for_mission(@User?.Claims.FirstOrDefault(c=>c.Type==ClaimTypes.Sid)?.Value,@item.MissionId)" class="applyButton btn">
                                    Apply Now<img src="images/right-arrow.png" alt="">
                                </button>
                            }
                        </a>
                    </div>
                </div>
            </div>

        </div>



        @*recommand*@

        //        <div class="modal fade" id="recommend" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        //    <div class="modal-dialog modal-dialog-scrollable">
        //        <div class="modal-content">
        //            <div class="modal-header">
        //                <h5 class="modal-title" id="staticBackdropLabel">Select Co-Workers Who You Want To Recommend This Mission</h5>
        //            </div>
        //            <div class="modal-body">
        //                @{
        //                    @foreach (var Model in @Model.All_volunteers)
        //                    {
        //                        <div class="d-flex mt-3 bg-white align-items-center">
        //                            <input class="form-check-input" onclick="add_coworkers('coworker-@Model.UserId')" type="checkbox" value="" id='coworker-@Model.UserId'>
        //                            <img class="rounded-circle usercomment-image ms-2" src="~/images/volunteer1.png" alt="" />
        //                            <span class="ms-2">@Model.FirstName @Model.LastName</span>
        //                        </div>
        //                    }
        //                }
        //            </div>
        //            <div class="modal-footer">
        //                <button type="button" class="btn applyButton" data-bs-dismiss="modal">Close</button>
        //                <button type="button" onclick="recommend(@User?.Claims.FirstOrDefault(c=>c.Type==ClaimTypes.Sid)?.Value,@Model?.Missions)" class="btn applyButton" data-bs-dismiss="modal">Recommend</button>
        //            </div>
        //        </div>
        //    </div>
        //</div>






    }


}
@*
    <div class="modal fade" id="recommend" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticbackdroplabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
    <div class="modal-header">
    <h5 class="modal-title" id="staticbackdroplabel">select co-workers who you want to recommend this mission</h5>
    </div>
    <div class="modal-body">
    @{
    @foreach (var item in @model.all_volunteers)
    {
    <div class="d-flex mt-3 bg-white align-items-center">
    <input class="form-check-input" onclick="add_coworkers('coworker-@item.userid')" type="checkbox" value="" id='coworker-@item.userid'>
    <img class="rounded-circle usercomment-image ms-2" src="~/images/volunteer1.png" alt="" />
    <span class="ms-2">@item.firstname @item.lastname</span>
    </div>
    }
    }
    </div>
    <div class="modal-footer">
    <button type="button" class="btn applybutton" data-bs-dismiss="modal">close</button>
    <button type="button" onclick="recommend(@user?.claims.firstordefault(c=>c.type==claimtypes.sid)?.value,@model.missions)" class="btn applybutton" data-bs-dismiss="modal">recommend</button>
    </div>
    </div>
    </div>
    </div>
*@